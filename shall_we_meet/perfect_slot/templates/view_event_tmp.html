{% extends 'homepage.html' %}
{% load crispy_forms_tags %}


{% block mytitle %}<h1>Meeting: {{ event.title }}</h1>{% endblock %}

{% block event %}

    {% if event.owner == request.user %}
        <div class="float-right">
            {% if not chosen_slot %}
            <a type="button" class="btn btn-info myButton" href="{% url "edit_event" event.pk %}">Edit</a>
             {% endif %}
            <a type="button" class="btn btn-info myButton" href="{% url "delete_event" event.pk %}">Delete</a></br></br>
        </div>
    {% endif %}

    <table class="table table-striped table-sm">
        <tbody>
        <tr>
            <th scope="row">Status:</th>
            <td><b>
                {% if event.is_in_progress %}
                    In progress
                {% elif event %}
                    Upcoming
                {% elif event %}
                    Archived
                {% endif %}
            </b>
            </td>
        </tr>
        <tr>
            <th scope="row">Description:</th>
            <td>{{ event.description }}</td>
        </tr>
        <tr>
            <th scope="row">Location:</th>
            <td>{{ event.location }}</td>
        </tr>
        <tr>
            <th scope="row">Duration:</th>
            <td>{{ event.approx_duration }} hours</td>
        </tr>
        <tr>
            <th scope="row">Organizer:</th>
            <td>{{ event.owner }}</td>
        </tr>
        <tr>
            <th scope="row">Participants ({{ event.participants.count }}):</th>
            <td></td>
        </tr>
        {% for participant in event.participants.all %}
            <tr>
                <th scope="row"></th>
                <td>{{ forloop.counter }}. {{ participant }}</td>
            </tr>
        {% endfor %}

        {% if not chosen_slot %}
            <tr>
                <th scope="row">Proposed time slots:</th>
                <td>
                    {% if event.owner != request.user %}
                        <a type="button" class="btn btn-info myButton" href="{% url "vote_for_timeslots" event.pk %}">Click
                            here to vote
                            for time slots</a>
                    {% else %}
                        <a type="button" class="btn btn-info myButton" href="{% url "complete_event" event.pk %}">Choose
                            final time slot</a>
                    {% endif %}
                </td>
            </tr>
            {% for slot, slot_values in event_votes.items %}
                <tr>
                    <th scope="row">
                        {% if slot in winning %}
                            <span class="badge badge-dark badge-pill float-right">CURRENTLY WINNING</span>
                        {% endif %}
                    </th>
                    <td>{{ slot.date_time_from|date:'d.m.Y H:i (D)'}} - {{ slot.date_time_to|date:'d.m.Y H:i (D)'}}
                        <span class="badge badge-dark  vote-badge float-right">If need be: {{ slot_values.if_need_be }}</span>
                        <span class="badge badge-dark  vote-badge float-right">No: {{ slot_values.no }}</span>
                        <span class="badge badge-dark  vote-badge float-right">Yes: {{ slot_values.yes }} </span>
                    </td>
                </tr>
            {% endfor %}
        {% else %}
            <tr>
                <th scope="row">Date and time:</th>
                <td>{{ chosen_slot.date_time_from|date:'d.m.Y H:i (D)'}} - {{ chosen_slot.date_time_to|date:'d.m.Y H:i (D)'}}</td>
            </tr>
        {% endif %}

        <tr>
            <th scope="row">Created on:</th>
            <td>{{ event.creation_time }}</td>
        </tr>
        </tbody>
    </table>


{% endblock %}

</div>